# Database Engine

Модуль `engine.py` отвечает за настройку и управление подключением к базе данных с использованием SQLAlchemy. Он предоставляет асинхронный движок и фабрику сессий для работы с базой данных.

## Основные компоненты

### Глобальные переменные
- `engine`: Асинхронный движок SQLAlchemy для подключения к БД
- `SessionLocal`: Фабрика для создания асинхронных сессий

### Функции

#### `init_engine(db_url: str) -> None`
Инициализирует подключение к базе данных и настраивает пул соединений.

**Параметры:**
- `db_url`: Строка подключения к базе данных (например, `postgresql+asyncpg://user:password@localhost/dbname`)

**Настройки пула соединений:**
- `pool_size=5`: Количество соединений, которые будут поддерживаться в пуле
- `max_overflow=10`: Максимальное количество соединений сверх `pool_size`
- `pool_timeout=30`: Время ожидания свободного соединения (секунды)
- `pool_pre_ping=True`: Проверка соединения перед использованием
- `pool_recycle=300`: Время жизни соединения до пересоздания (секунды)
- `connect_timeout=5`: Таймаут установки соединения (секунды)

## Пример использования

```python
from src.infrastructure.database.engine import init_engine, SessionLocal

# Инициализация движка
init_engine("postgresql+asyncpg://user:password@localhost/eebook")

# Использование сессии
async with SessionLocal() as session:
    # Работа с базой данных
    result = await session.execute("SELECT 1")
    print(result.scalar())
```

## Особенности

- **Асинхронность**: Использует асинхронные операции ввода-вывода
- **Пул соединений**: Эффективное управление соединениями с БД
- **Автоматическое восстановление**: Проверка и восстановление соединений
- **Типизация**: Поддержка статической типизации через аннотации

## Требования

- SQLAlchemy с поддержкой асинхронности
- Асинхронный драйвер базы данных (например, asyncpg для PostgreSQL)

::: src.infrastructure.database.engine
    options:
      heading_level: 2
      show_source: true
